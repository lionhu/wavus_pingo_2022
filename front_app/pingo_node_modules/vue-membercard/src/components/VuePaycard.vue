<template>
  <div
    class="card-item"
    :class="{ '-active': isCardFlipped }"
    v-if="labels"
  >
    <div class="card-item__side -front">
      <div
        :class="{ '-active': focusElementStyle }"
        :style="focusElementStyle"
        class="card-item__focus"
        ref="focusElement"
      ></div>

      <div class="card-item__cover" :aria-label="imageCover">
        <img
          v-if="currentCardBackground"
          :src="currentCardBackground"
          class="card-item__bg"
          alt="Background image"
        />
      </div>
      <div class="card-item__wrapper">
        <div class="card-item__top">
          <img :src="qr_image" class="card-item__chip" alt="Card chip image"/>
          <div class="card-item__type">
            <transition name="slide-fade-up">
              <img
                :src="getCreditCardImage"
                class="card-item__typeImg"
              />
            </transition>
          </div>
        </div>
        <label :ref="valueFields.memberEmail" aria-label="Card number" class="card-item__number" >
            <span> {{ valueFields.memberEmail }} </span>
        </label>
        <div class="card-item__content">
          <label class="card-item__info" >
            <div class="card-item__holder">
              {{ labels.memberPoints || "Card Holder" }}
            </div>
            <transition name="slide-fade-up">
              <div class="card-item__name">
                <span>{{ valueFields.points | currency }}</span>
              </div>
            </transition>
          </label>
          <div class="card-item__date" ref="cardDate">
            <label  class="card-item__holder" aria-label="Expiration date">{{ labels.memberFollowers }}</label>
            <label class="card-item__dateItem" aria-label="Card month">
              <transition name="slide-fade-up">
                <span>{{ valueFields.followers |currency  }}</span>
              </transition>
            </label>
          </div>
        </div>
      </div>
    </div>
    <div class="card-item__side -back">
      <div class="card-item__cover" :aria-label="imageCover">
        <img
          v-if="currentCardBackground"
          :src="currentCardBackground"
          class="card-item__bg"
          alt="Background image"
        />
      </div>
      <div class="card-item__band"></div>
    </div>
  </div>
</template>

<script>
import QRCode from 'qrcode'
import {mapGetters} from "vuex"

export default {
  name: 'VuePaycard',
  props: {
    valueFields: {
      type: Object,
      required: true
    },
    labels: {
      type: Object,
      default: () => ({
        memberName: 'Full Name',
        memberEmail: "v-memberEmail",
        membership: "v-membership",
        cardHolder: 'Member Name ',
        memberFollowers: 'Followers',
        memberPoints: 'Points',
      })
    },
    hasRandomBackgrounds: {
      type: Boolean,
      default: true
    },
    backgroundImage: {
      type: [String, Number],
      default: ''
    }
  },
  data() {
    return {
      focusElementStyle: null,
      currentFocus: null,
      isFocused: false,
      isCardFlipped: false,
      qr_image:null
    }
  },
  watch: {
    currentFocus() {
      if (this.currentFocus) {
        this.changeFocus()
      } else {
        this.focusElementStyle = null
      }
    },
    valueFields(newVal, oldVal) {
      console.log("valueFields newVal", newVal)
    }
  },
  mounted() {
    this.init()
  },

  computed: {
    getCreditCardImage() {
      return require(`../assets/images/pingo.png`)
    },
    imageCover() {
      return !this.hasRandomBackgrounds && parseInt(this.backgroundImage)
        ? 'Image cover'
        : ''
    },
    isBackgroundImageFromAssets() {
      const numberImage = parseInt(this.backgroundImage)

      return Number.isFinite(numberImage) && parseInt(numberImage) < 26 && parseInt(numberImage) > 0
    },
    currentCardBackground() {
      if (this.valueFields.membership==="") return require(`../assets/images/21.jpg`);
        return require(`../assets/images/${this.valueFields.membership}.jpg`)
    }
  },
  methods: {
    init() {
      this.generate_qr()
    },
    generate_qr() {
      if (this.valueFields.introcode ==="" || this.valueFields.url==="")return;

      const url = this.valueFields.url
      const width = 160
      QRCode.toDataURL(url, {width: width})
        .then(code => {
          this.qr_image = code;
        })
    },
    changeFocus() {
      const target = this.$refs[this.currentFocus]
      this.focusElementStyle = target
        ? {
          width: `${target.offsetWidth}px`,
          height: `${target.offsetHeight}px`,
          transform: `translateX(${target.offsetLeft}px) translateY(${target.offsetTop}px)`
        }
        : null
    },
  }
}
</script>

<style src="../assets/css/style.min.css" scoped></style>
